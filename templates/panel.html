<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Panel de Ajustes MLB</title>

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
    body {
        background:#1a1a1a;
        color:white;
        font-family:Arial, sans-serif;
        padding:15px;
        margin:0;
    }

    h2 {
        color:#26c6da;
        font-size:1.5rem;
        text-align:center;
        margin-bottom:10px;
    }

    p {
        text-align:center;
        font-size:0.9rem;
        color:#bbb;
    }

    /* Combobox */
    #teamSelector {
        width:100%;
        padding:10px;
        font-size:1rem;
        border-radius:6px;
        margin-top:10px;
        background:#222;
        color:white;
        border:1px solid #555;
    }

    #gotoEndBtn {
        width:100%;
        padding:10px;
        background:#4caf50;
        border:none;
        color:black;
        font-weight:bold;
        border-radius:6px;
        margin-top:12px;
        cursor:pointer;
    }

    #gotoEndBtn:hover {
        background:#43a047;
    }

    table {
        width:100%;
        border-collapse:collapse;
        margin-top:15px;
    }

    th, td {
        border:1px solid #444;
        padding:8px;
        text-align:center;
        font-size:0.9rem;
    }

    th {
        background:#222;
    }

    input {
        width:70px;
        padding:5px;
        border-radius:4px;
        border:1px solid #666;
        background:#333;
        color:white;
        text-align:center;
    }

    button.save-btn {
        width:100%;
        padding:12px;
        background:#26c6da;
        border:none;
        color:black;
        font-weight:bold;
        cursor:pointer;
        border-radius:6px;
        margin-top:20px;
        font-size:1rem;
    }

    button.save-btn:hover {
        background:#00acc1;
    }

    /* üì± Vista m√≥vil */
    @media (max-width: 600px) {

        table, thead, tbody, th, td, tr {
            display:block;
        }

        thead {
            display:none;
        }

        tr {
            background:#222;
            margin-bottom:12px;
            padding:10px;
            border-radius:8px;
        }

        td {
            border:none;
            text-align:left;
            padding:6px 0;
            font-size:0.9rem;
        }

        td::before {
            content: attr(data-label);
            font-weight:bold;
            color:#26c6da;
            display:block;
            margin-bottom:3px;
        }

        input {
            width:100%;
        }

        button.save-btn {
            font-size:1.1rem;
        }
    }
</style>
</head>

<body>

<h2>‚öæ Ajustes de Equipos ‚Äì Panel Seguro</h2>

<p>Selecciona un equipo para ir directo a su l√≠nea.</p>

<select id="teamSelector">
    <option value="">Buscar equipo...</option>
</select>

<button id="gotoEndBtn">‚¨á Ir al final (Guardar cambios)</button>

<table id="tbl">
    <thead>
        <tr>
            <th>Equipo</th>
            <th>Ajuste Wins</th>
            <th>Ajuste Losses</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<button class="save-btn" onclick="save()">Guardar cambios</button>

<script>
let teamRows = {}; // Guardar√° referencia a cada fila

// Cargar ajustes
fetch("adjustments.json")
    .then(r => r.json())
    .then(data => {
        const tbody = document.querySelector("#tbl tbody");
        const selector = document.getElementById("teamSelector");

        const adj = data.TEAM_RECORD_ADJUSTMENTS;

        for (const [team, vals] of Object.entries(adj)) {

            // Agregar al combo
            const op = document.createElement("option");
            op.value = team;
            op.textContent = team;
            selector.appendChild(op);

            // Crear fila
            const tr = document.createElement("tr");
            tr.innerHTML = `
                <td data-label="Equipo">${team}</td>
                <td data-label="Ajuste Wins"><input type="number" value="${vals[0]}" data-team="${team}" data-type="wins" class="wins"></td>
                <td data-label="Ajuste Losses"><input type="number" value="${vals[1]}" data-team="${team}" data-type="losses" class="losses"></td>
            `;

            tbody.appendChild(tr);

            // Guardar referencia para scroll luego
            teamRows[team] = tr;
        }
    });

// Cuando se selecciona un equipo en el combo
document.getElementById("teamSelector").addEventListener("change", function () {
    const team = this.value;
    if (!team) return;

    const row = teamRows[team];
    if (!row) return;

    // Hacer scroll hacia la fila
    row.scrollIntoView({ behavior: "smooth", block: "center" });

    // Esperar que el scroll termine y enfocar Wins
    setTimeout(() => {
        const inputWins = row.querySelector(".wins");
        inputWins.focus();
        inputWins.select();
    }, 400);

    // Cuando se modifique un input, volver al combobox
    const inputs = row.querySelectorAll("input");
    inputs.forEach(i => {
        i.addEventListener("change", () => {
            document.getElementById("teamSelector").focus();
        });
    });
});

// Bot√≥n para ir al final de la pantalla
document.getElementById("gotoEndBtn").addEventListener("click", () => {
    window.scrollTo({ top: document.body.scrollHeight, behavior: "smooth" });
});

// Guardar ajustes
function save() {
    const inputs = document.querySelectorAll("input");
    let updated = {};

    inputs.forEach(i => {
        const team = i.dataset.team;
        const type = i.dataset.type;
        if (!updated[team]) updated[team] = [0, 0];
        if (type === "wins") updated[team][0] = parseInt(i.value);
        if (type === "losses") updated[team][1] = parseInt(i.value);
    });

    const payload = {
        TEAM_RECORD_ADJUSTMENTS: updated,
        TEAM_POINT_ADJUSTMENTS: {}
    };

    fetch("/update-adjustments", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
    })
    .then(r => r.text())
    .then(() => alert("‚úÖ Ajustes guardados exitosamente"))
    .catch(() => alert("‚ùå Error al guardar ajustes"));
}
</script>

</body>
</html>
